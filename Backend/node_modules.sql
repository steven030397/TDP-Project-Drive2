CREATE DATABASE Drive2_db;
\c Drive2_db;

--Create the Tables--
-- User Table
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL
);

-- User Personal Details Table
CREATE TABLE user_personal_details (
    user_id SERIAL PRIMARY KEY,                      -- Unique identifier for each user
    first_name VARCHAR(50) NOT NULL,                -- User's first name
    middle_name VARCHAR(50),                         -- User's middle name (optional)
    last_name VARCHAR(50) NOT NULL,                 -- User's last name
    date_of_birth DATE NOT NULL,                     -- User's date of birth
    gender VARCHAR(10) CHECK (gender IN ('Male', 'Female', 'Other')),  -- User's gender
    phone_number VARCHAR(15),                        -- User's phone number
    address VARCHAR(255) NOT NULL,                   -- User's address
    state VARCHAR(50) NOT NULL,                      -- User's state
    driver_license_number VARCHAR(20) NOT NULL,     -- User's driver license number
    has_car BOOLEAN NOT NULL                         -- Indicates if the user has a car (TRUE/FALSE)
);


-- Vehicle Data Table
CREATE TABLE vehicles (
    vehicle_id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(user_id),
    car_model VARCHAR(100),
    license_plate VARCHAR(20) UNIQUE,
    color VARCHAR(50)
);

-- Car Model Information Table
CREATE TABLE car_models (
    model_id SERIAL PRIMARY KEY,
    model_name VARCHAR(100) UNIQUE NOT NULL,
    manufacturer VARCHAR(100),
    year_of_manufacture INT
);

CREATE TABLE travel_logs (
    log_id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(user_id),
    start_latitude DECIMAL(9,6) NOT NULL,
    start_longitude DECIMAL(9,6) NOT NULL,
    start_point_name VARCHAR(100) NOT NULL,
    end_latitude DECIMAL(9,6) NOT NULL,
    end_longitude DECIMAL(9,6) NOT NULL,
    end_point_name VARCHAR(100) NOT NULL,
    start_time TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    end_time TIMESTAMPTZ,
    travel_time INTERVAL GENERATED ALWAYS AS (end_time - start_time) STORED,
    travel_days VARCHAR(9)[] NOT NULL  -- Array of days, e.g., '{Monday,Wednesday}'
    weekly_mileage_percentage DECIMAL(5,2) NOT NULL CHECK (weekly_mileage_percentage >= 0 AND weekly_mileage_percentage <= 100),  -- Percentage of weekly travel mileage due to regular commute
    weekly_fuel_spent DECIMAL(10,2) NOT NULL  -- Approximate amount spent on fuel weekly in currency units
);

CREATE TABLE matching_data (
    match_id SERIAL PRIMARY KEY,
    user_id_person1 INT REFERENCES users(user_id),
    user_id_person2 INT REFERENCES users(user_id),
    match_time TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    start_point_name VARCHAR(100) NOT NULL,
    end_point_name VARCHAR(100) NOT NULL,
    status VARCHAR(50) NOT NULL,
    driver_name VARCHAR(100) NOT NULL
);


-- Insert data into Users Table
INSERT INTO users (username, password, email) VALUES
('john_doe', 'password123', 'john.doe@example.com'),
('jane_smith', 'password456', 'jane.smith@example.com'),
('michael_brown', 'password789', 'michael.brown@example.com'),
('emily_white', 'password012', 'emily.white@example.com'),
('david_jones', 'password345', 'david.jones@example.com');

-- Insert data into User Personal Details Table
INSERT INTO user_personal_details (user_id, first_name, middle_name, last_name, date_of_birth, gender, phone_number, address, state, driver_license_number, has_car) VALUES
(1, 'John', 'A', 'Doe', '1985-01-15', 'Male', '123-456-7890', '123 Maple St, Springfield', 'Illinois', 'D1234567', TRUE),
(2, 'Jane', NULL, 'Smith', '1990-06-22', 'Female', '987-654-3210', '456 Oak St, Springfield', 'Illinois', 'S2345678', TRUE),
(3, 'Michael', 'B', 'Brown', '1988-09-05', 'Male', '555-666-7777', '789 Pine St, Springfield', 'Illinois', 'B3456789', FALSE),
(4, 'Emily', NULL, 'White', '1992-12-11', 'Female', '444-555-6666', '321 Birch St, Springfield', 'Illinois', 'W4567890', TRUE),
(5, 'David', 'C', 'Jones', '1983-03-27', 'Male', '333-444-5555', '654 Cedar St, Springfield', 'Illinois', 'J5678901', FALSE);

-- Insert data into Vehicles Table
INSERT INTO vehicles (user_id, car_model, license_plate, color) VALUES
(1, 'Toyota Camry', 'ABC1234', 'Red'),
(2, 'Honda Civic', 'XYZ5678', 'Blue'),
(4, 'Ford Focus', 'DEF9101', 'Black'),
(5, 'Chevrolet Malibu', 'GHI2345', 'White'),
(1, 'Tesla Model 3', 'JKL6789', 'Silver');

-- Insert data into Car Models Table
INSERT INTO car_models (model_name, manufacturer, year_of_manufacture) VALUES
('Camry', 'Toyota', 2020),
('Civic', 'Honda', 2019),
('Focus', 'Ford', 2018),
('Malibu', 'Chevrolet', 2021),
('Model 3', 'Tesla', 2022);

-- Insert data into Travel Logs Table
INSERT INTO travel_logs (user_id, start_latitude, start_longitude, start_point_name, end_latitude, end_longitude, end_point_name, start_time, end_time, travel_days, weekly_mileage_percentage, weekly_fuel_spent) VALUES
(1, 39.7817, -89.6501, 'Home', 39.7990, -89.6443, 'Work', '2024-08-20 08:00:00', '2024-08-20 08:30:00', '{Monday,Wednesday,Friday}', 50.00, 30.00),
(2, 39.7817, -89.6501, 'Home', 39.8144, -89.6545, 'Gym', '2024-08-20 17:00:00', '2024-08-20 17:15:00', '{Tuesday,Thursday}', 20.00, 10.00),
(3, 39.7817, -89.6501, 'Home', 39.7817, -89.6502, 'Store', '2024-08-21 18:00:00', '2024-08-21 18:10:00', '{Monday,Wednesday,Sunday}', 10.00, 5.00),
(4, 39.7990, -89.6443, 'Work', 39.7817, -89.6501, 'Home', '2024-08-21 17:30:00', '2024-08-21 18:00:00', '{Monday,Wednesday,Friday}', 60.00, 35.00),
(5, 39.7817, -89.6501, 'Home', 39.8144, -89.6545, 'Friend\'s House', '2024-08-22 19:00:00', '2024-08-22 19:20:00', '{Saturday}', 30.00, 15.00);

-- Insert data into Matching Data Table
INSERT INTO matching_data (user_id_person1, user_id_person2, start_point_name, end_point_name, status, driver_name) VALUES
(1, 2, 'Home', 'Work', 'Matched', 'John Doe'),
(2, 3, 'Home', 'Gym', 'Pending', 'Jane Smith'),
(4, 5, 'Work', 'Home', 'Confirmed', 'Emily White'),
(3, 1, 'Store', 'Home', 'Declined', 'Michael Brown'),
(5, 4, 'Friend\'s House', 'Home', 'Matched', 'David Jones');
