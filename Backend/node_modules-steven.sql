CREATE DATABASE Drive2_db;
\c Drive2_db;

--Create the Tables--
-- User Table
CREATE TABLE users (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(256) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,                
    first_name VARCHAR(50) NOT NULL,                -- User's first name
    middle_name VARCHAR(50),                         -- User's middle name (optional)
    last_name VARCHAR(50) NOT NULL,                 -- User's last name
    date_of_birth DATE NOT NULL,                     -- User's date of birth
    gender VARCHAR(10) CHECK (gender IN ('Male', 'Female', 'Non-Binary', 'Other', 'Prefer Not to Say')),  -- User's gender
    phone_number VARCHAR(15),                        -- User's phone number
    address VARCHAR(255) NOT NULL,                   -- User's address
    state VARCHAR(50) NOT NULL,                      -- User's state
    driver_license_number VARCHAR(20) NOT NULL,     -- User's driver license number
    has_car BOOLEAN NOT NULL                         -- Indicates if the user has a car (TRUE/FALSE)
);

-- Car Model Information Table
CREATE TABLE car_models (
    model_id INT AUTO_INCREMENT PRIMARY KEY,
    model_name VARCHAR(100) UNIQUE NOT NULL,
    manufacturer VARCHAR(100),
    year_of_manufacture INT
);

-- Vehicle Data Table
CREATE TABLE vehicles (
    vehicle_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    car_model_id INT, 
    FOREIGN KEY (car_model_id) REFERENCES car_models(model_id),
    car_model VARCHAR(100),
    car_brand VARCHAR(100),
    car_year INT,
    license_plate VARCHAR(20) UNIQUE,
    garage_address VARCHAR(255) NOT NULL
);

CREATE TABLE route (
    route_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    start_latitude DECIMAL(9,6) NOT NULL,
    start_longitude DECIMAL(9,6) NOT NULL,
    start_point_name VARCHAR(100) NOT NULL,
    end_latitude DECIMAL(9,6) NOT NULL,
    end_longitude DECIMAL(9,6) NOT NULL,
    end_point_name VARCHAR(100) NOT NULL,
    leave_start_time VARCHAR(20), -- time leaving starting point (home)
    destination_arrival_time VARCHAR(20), -- time arriving ending point (office)
    destination_departure_time VARCHAR(20), -- time leaving ending point (office)
    arrive_start_time VARCHAR(20), -- time arriving starting point (home)
    travel_time INT,
    travel_day VARCHAR(9) NOT NULL,  -- etc 'Monday'
    weekly_mileage_percentage DECIMAL(5,2) NOT NULL CHECK (weekly_mileage_percentage >= 0 AND weekly_mileage_percentage <= 100),  -- Percentage of weekly travel mileage due to regular commute
    weekly_fuel_spent DECIMAL(10,2) NOT NULL  -- Approximate amount spent on fuel weekly in currency units
);

CREATE TABLE matching_data (
    match_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id_person1 INT,
    user_id_person2 INT,
    FOREIGN KEY (user_id_person1) REFERENCES users(user_id),
    FOREIGN KEY (user_id_person2) REFERENCES users(user_id),
    match_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    start_point_name VARCHAR(100) NOT NULL,
    end_point_name VARCHAR(100) NOT NULL,
    status VARCHAR(50) NOT NULL,
    driver_name VARCHAR(100) NOT NULL
);

