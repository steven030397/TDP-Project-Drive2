<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='icons/favicon/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="96x96" href="{{ url_for('static', filename='icons/favicon/favicon-96x96.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='icons/favicon/favicon-16x16.png') }}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Details - DRIVE2</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <!-- Top Bar -->
    <header>
        <div class="topbar">
            <div class="logo">
                <a href="{{ url_for('index') }}"><img src="{{ url_for('static', filename='icons/Screenshot_2024-08-21_021632-removebg-preview.png') }}" alt="DRIVE2 Logo"></a> <!-- Replace with your logo -->
            </div>
            <nav>
                <a href="{{ url_for('register') }}"><button class="nav-button">Back</button></a>
            </nav>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="progress-bar">
        <div class="progress-step filled">1</div>
        <div class="progress-step filled">2</div>
        <div class="progress-step filled">3</div>
        <div class="progress-step">4</div>
        <div class="progress-step">5</div>
        <div class="progress-text">Step 3 of 5</div>
    </div>

    <!-- Flash message section -->
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <ul class="flashes">
                {% for message in messages %}
                    <li>{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <!-- Vehicle Details Form -->
    <div class="form-container">
        <h1>Vehicle Details</h1>
        <form id="vehicle-form" action="{{ url_for('vehicle') }}" method="POST">
            <div class="form-group">
                <label>Do you have a car?</label>
                <input type="radio" id="car-yes" name="hasCar" value="yes">
                <label for="car-yes">Yes</label>
                <input type="radio" id="car-no" name="hasCar" value="no" checked>
                <label for="car-no">No</label>
            </div>

                <div id="additional-vehicles"></div>

                <button type="button" id="add-vehicle" style="display: none;" onclick="addVehicleForm()">Add Vehicle</button>
            </div>

            <div class="form-group">
                <button type="submit" style="margin-bottom: 100px;">Continue to Next Step</button>
            </div>
        </form>
    </div>

    <!-- Footer Section -->
    <footer>
        <p>&copy; 2024 DRIVE2. All rights reserved.</p>
    </footer>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBWW9zve7B8Zy7HM2mHDtNz8HXED_HiFlg&libraries=places"></script>
    <script>
        let i = 1;
    
        // Function to initialize Google Places Autocomplete on address fields
        function initAutocomplete(inputElement) {
            var autocomplete = new google.maps.places.Autocomplete(inputElement, {
                types: ['address'],
                componentRestrictions: { country: 'au' }
            });
    
            autocomplete.addListener('place_changed', function () {
                var place = autocomplete.getPlace();
                if (place.geometry) {
                    console.log('Address selected:', place.formatted_address);
                }
            });
        }
    
        // Function to add a new vehicle form
        function addVehicleForm() {
            const container = document.getElementById('additional-vehicles');
            const vehicleForm = document.createElement('div');
            vehicleForm.classList.add('vehicle-form');
            vehicleForm.innerHTML = `
                <h3>Vehicle ${i}</h3>   ## Just make the input tag have the "datalist" type, with the options being filled at the load of the page by JavaScript after parsing the csv file, then make the model select tag hidden when the make input does not have a valid make
                <div class="form-group">
                    <label for="brand">Brand:</label>
                    <select name="brand[]">
                        <option value="">Select Brand</option>
                        <option value="Toyota">Toyota</option>
                        <option value="Honda">Honda</option>
                        <option value="Ford">Ford</option>
                        <option value="BMW">BMW</option>
                        <option value="Audi">Audi</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="model">Model:</label>
                    <input type="text" name="model[]">
                </div>
                <div class="form-group">
                    <label for="year">Year:</label>
                    <select name="year[]">
                        <option value="">Select Year</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="registration">Registration No:</label>
                    <input type="text" name="registration[]">
                </div>
                <div class="form-group">
                    <label for="garage-location-${i}">Garage Location:</label>
                    <input type="text" id="garage-location-${i}" name="garage-location[]">
                </div>
            `;
            container.appendChild(vehicleForm);
            populateYearOptions();
    
            // Initialize autocomplete for the new garage address input
            const addressInput = document.getElementById(`garage-location-${i}`);
            initAutocomplete(addressInput);
    
            i++;
        }
    
        // Populate year options for vehicle forms
        function populateYearOptions() {
            const yearSelects = document.querySelectorAll('select[name="year[]"]');
            const currentYear = new Date().getFullYear();
            for (let i = currentYear; i >= 1950; i--) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                yearSelects.forEach(select => select.appendChild(option.cloneNode(true)));
            }
        }
    
        document.addEventListener('DOMContentLoaded', function () {
            populateYearOptions();
            const carYes = document.getElementById('car-yes');
            const carNo = document.getElementById('car-no');
            const addCar = document.getElementById('add-vehicle');
    
            function toggleCarDetails() {
                addCar.style.display = carYes.checked ? 'block' : 'none';
            }
    
            carYes.addEventListener('change', toggleCarDetails);
            carNo.addEventListener('change', toggleCarDetails);
    
            // Initialize the state on page load
            toggleCarDetails();
        });
    
        // Clear all vehicle forms when "No" is selected for car
        document.getElementById('car-no').addEventListener('click', function () {
            const container = document.getElementById('additional-vehicles');
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }
            i = 1;
        });
    </script>
    
</body>
</html>
