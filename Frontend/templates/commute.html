<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='icons/favicon/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="96x96" href="{{ url_for('static', filename='icons/favicon/favicon-96x96.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='icons/favicon/favicon-16x16.png') }}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration - DRIVE2</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        .map-details-container {
            display: flex;
            margin-bottom: 20px;
        }
        
        #map {
            width: 60%;
            height: 300px;
            margin-right: 20px;
        }
        
        #details-box {
            width: 35%;
            padding: 15px;
            border: 1px solid #ccc;
            background-color: #000000;
        }
        
        #details-box h3 {
            margin-top: 0;
        }
        
        #details-box p {
            margin: 5px 0;
        }       
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBWW9zve7B8Zy7HM2mHDtNz8HXED_HiFlg&libraries=places"></script>
    <script>
        function toggleTimeFields(day) {
            var timeFields = document.getElementById(day + '-time-fields');
            var checkbox = document.getElementById(day);

            if (checkbox.checked) {
                timeFields.style.display = 'block';
            } else {
                timeFields.style.display = 'none';
            }
        }

        function initAutocomplete() {
    var homeAddressInput = document.getElementById('home-address');
    var officeAddressInput = document.getElementById('office-address');

    var homeAutocomplete = new google.maps.places.Autocomplete(homeAddressInput, {
        types: ['address'],
        componentRestrictions: { country: 'au' }
    });

    var officeAutocomplete = new google.maps.places.Autocomplete(officeAddressInput, {
        types: ['address'],
        componentRestrictions: { country: 'au' }
    });

    // Initialize map
    var map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: -34.397, lng: 150.644},
        zoom: 8
    });

    var directionsService = new google.maps.DirectionsService();
    var directionsRenderer = new google.maps.DirectionsRenderer();
    directionsRenderer.setMap(map);

    homeAutocomplete.addListener('place_changed', function() {
        var homePlace = homeAutocomplete.getPlace();
        document.getElementById('lat1').value = homePlace.geometry.location.lat();
        document.getElementById('lng1').value = homePlace.geometry.location.lng();
        if (homePlace.geometry) {
            calculateAndDisplayRoute(directionsService, directionsRenderer);
        }
    });

    officeAutocomplete.addListener('place_changed', function() {
        var officePlace = officeAutocomplete.getPlace();
        document.getElementById('lat2').value = officePlace.geometry.location.lat();
        document.getElementById('lng2').value = officePlace.geometry.location.lng();
        if (officePlace.geometry) {
            calculateAndDisplayRoute(directionsService, directionsRenderer);
        }
    });

    function calculateAndDisplayRoute(directionsService, directionsRenderer) {
        var homePlace = homeAutocomplete.getPlace();
        var officePlace = officeAutocomplete.getPlace();

        if (homePlace && officePlace && homePlace.geometry && officePlace.geometry) {
            directionsService.route(
                {
                    origin: homePlace.geometry.location,
                    destination: officePlace.geometry.location,
                    travelMode: google.maps.TravelMode.DRIVING
                },
                function(response, status) {
                    if (status === 'OK') {
                        directionsRenderer.setDirections(response);

                        // Extract and display route details
                        var route = response.routes[0].legs[0];
                        document.getElementById('distance').textContent = 'Distance: ' + route.distance.text;
                        document.getElementById('duration').textContent = 'Estimated Duration: ' + route.duration.text;
                    } else {
                        window.alert('Directions request failed due to ' + status);
                    }
                }
            );
        }
    }
}

window.onload = initAutocomplete;

    </script>
</head>
<body>
    <!-- Top Bar -->
    <header>
        <div class="topbar">
            <div class="logo">
                <a href="{{ url_for('index') }}"><img src="{{ url_for('static', filename='icons/Screenshot_2024-08-21_021632-removebg-preview.png') }}" alt="DRIVE2 Logo"></a>
            </div>
            <nav>
                <a href="{{ url_for('vehicle') }}"><button class="nav-button">Back</button></a>
            </nav>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="progress-bar">
        <div class="progress-step filled">1</div>
        <div class="progress-step filled">2</div>
        <div class="progress-step filled">3</div>
        <div class="progress-step filled">4</div>
        <div class="progress-step">5</div>
        <div class="progress-text">Step 4 of 5</div>
    </div>

    <!-- Flash message section -->
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <ul class="flashes">
                {% for message in messages %}
                    <li>{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <!-- Registration Form Section -->
    <div class="registration-form">
        <h1>Commute Information</h1>

        <!-- Map and Details Container -->
        <div class="map-details-container">
            <!-- Google Map -->
            <div id="map"></div>

            <!-- Details Box -->
            <div id="details-box">
                <h3>Route Details</h3>
                <p id="distance">Distance: </p>
                <p id="duration">Estimated Duration: </p>
                <!-- Add any other details you want to show -->
            </div>
        </div>

        <form action="{{ url_for('commute') }}" method="POST">

            <div class="form-group">
                <label for="home-address">Enter the address of home location:</label>
                <input type="text" id="home-address" name="home-address" required>
                <input id="lat1" type="text" name="lat1" placeholder="Latitude 1" readonly />
                <input id="lng1" type="text" name="lng1" placeholder="Longitude 1" readonly />
            </div>

            <div class="form-group">
                <label for="office-address">Enter the address of daily commute destination:</label>
                <input type="text" id="office-address" name="office-address" required>
                <input id="lat2" type="text" name="lat2" placeholder="Latitude 2" readonly />
                <input id="lng2" type="text" name="lng2" placeholder="Longitude 2" readonly />
            </div>

            <div class="form-group-days">
                <label>Which days are you traveling on this route?</label><br>
                
                <!-- Checkboxes for each day of the week -->
                <div class="day-row">
                    <input type="checkbox" id="monday" name="days[]" value="Monday" onchange="toggleTimeFields('monday')">
                    <label for="monday">Monday</label>
                </div>
                <div id="monday-time-fields" class="time-fields" style="display:none;">
                    <div class="inline-fields">
                        <div>
                            <label for="monday-leave-home">Time Leave Home:</label>
                            <input type="time" id="monday-leave-home" name="monday-leave-home">
                        </div>
                        <div>
                            <label for="monday-arrive-office">Time Arrive Office:</label>
                            <input type="time" id="monday-arrive-office" name="monday-arrive-office">
                        </div>
                    </div>
                    <div class="inline-fields">
                        <div>
                            <label for="monday-leave-office">Time Leave Office:</label>
                            <input type="time" id="monday-leave-office" name="monday-leave-office">
                        </div>
                        <div>
                            <label for="monday-arrive-home">Time Arrive Home:</label>
                            <input type="time" id="monday-arrive-home" name="monday-arrive-home">
                        </div>
                    </div>
                </div>

                <!-- Repeat for other days... -->

                <div class="day-row">
                    <input type="checkbox" id="tuesday" name="days[]" value="Tuesday" onchange="toggleTimeFields('tuesday')">
                    <label for="tuesday">Tuesday</label>
                </div>
                <div id="tuesday-time-fields" class="time-fields" style="display:none;">
                    <div class="inline-fields">
                        <div>
                            <label for="tuesday-leave-home">Time Leave Home:</label>
                            <input type="time" id="tuesday-leave-home" name="tuesday-leave-home">
                        </div>
                        <div>
                            <label for="tuesday-arrive-office">Time Arrive Office:</label>
                            <input type="time" id="tuesday-arrive-office" name="tuesday-arrive-office">
                        </div>
                    </div>
                    <div class="inline-fields">
                        <div>
                            <label for="tuesday-leave-office">Time Leave Office:</label>
                            <input type="time" id="tuesday-leave-office" name="tuesday-leave-office">
                        </div>
                        <div>
                            <label for="tuesday-arrive-home">Time Arrive Home:</label>
                            <input type="time" id="tuesday-arrive-home" name="tuesday-arrive-home">
                        </div>
                    </div>
                </div>

                <div class="day-row">
                    <input type="checkbox" id="wednesday" name="days[]" value="Wednesday" onchange="toggleTimeFields('wednesday')">
                    <label for="wednesday">Wednesday</label>
                </div>
                <div id="wednesday-time-fields" class="time-fields" style="display:none;">
                    <div class="inline-fields">
                        <div>
                            <label for="wednesday-leave-home">Time Leave Home:</label>
                            <input type="time" id="wednesday-leave-home" name="wednesday-leave-home">
                        </div>
                        <div>
                            <label for="wednesday-arrive-office">Time Arrive Office:</label>
                            <input type="time" id="wednesday-arrive-office" name="wednesday-arrive-office">
                        </div>
                    </div>
                    <div class="inline-fields">
                        <div>
                            <label for="wednesday-leave-office">Time Leave Office:</label>
                            <input type="time" id="wednesday-leave-office" name="wednesday-leave-office">
                        </div>
                        <div>
                            <label for="wednesday-arrive-home">Time Arrive Home:</label>
                            <input type="time" id="wednesday-arrive-home" name="wednesday-arrive-home">
                        </div>
                    </div>
                </div>

                <div class="day-row">
                    <input type="checkbox" id="thursday" name="days[]" value="Thursday" onchange="toggleTimeFields('thursday')">
                    <label for="thursday">Thursday</label>
                </div>
                <div id="thursday-time-fields" class="time-fields" style="display:none;">
                    <div class="inline-fields">
                        <div>
                            <label for="thursday-leave-home">Time Leave Home:</label>
                            <input type="time" id="thursday-leave-home" name="thursday-leave-home">
                        </div>
                        <div>
                            <label for="thursday-arrive-office">Time Arrive Office:</label>
                            <input type="time" id="thursday-arrive-office" name="thursday-arrive-office">
                        </div>
                    </div>
                    <div class="inline-fields">
                        <div>
                            <label for="thursday-leave-office">Time Leave Office:</label>
                            <input type="time" id="thursday-leave-office" name="thursday-leave-office">
                        </div>
                        <div>
                            <label for="thursday-arrive-home">Time Arrive Home:</label>
                            <input type="time" id="thursday-arrive-home" name="thursday-arrive-home">
                        </div>
                    </div>
                </div>

                <div class="day-row">
                    <input type="checkbox" id="friday" name="days[]" value="Friday" onchange="toggleTimeFields('friday')">
                    <label for="friday">Friday</label>
                </div>
                <div id="friday-time-fields" class="time-fields" style="display:none;">
                    <div class="inline-fields">
                        <div>
                            <label for="friday-leave-home">Time Leave Home:</label>
                            <input type="time" id="friday-leave-home" name="friday-leave-home">
                        </div>
                        <div>
                            <label for="friday-arrive-office">Time Arrive Office:</label>
                            <input type="time" id="friday-arrive-office" name="friday-arrive-office">
                        </div>
                    </div>
                    <div class="inline-fields">
                        <div>
                            <label for="friday-leave-office">Time Leave Office:</label>
                            <input type="time" id="friday-leave-office" name="friday-leave-office">
                        </div>
                        <div>
                            <label for="friday-arrive-home">Time Arrive Home:</label>
                            <input type="time" id="friday-arrive-home" name="friday-arrive-home">
                        </div>
                    </div>
                </div>

                <div class="day-row">
                    <input type="checkbox" id="saturday" name="days[]" value="Saturday" onchange="toggleTimeFields('saturday')">
                    <label for="saturday">Saturday</label>
                </div>
                <div id="saturday-time-fields" class="time-fields" style="display:none;">
                    <div class="inline-fields">
                        <div>
                            <label for="saturday-leave-home">Time Leave Home:</label>
                            <input type="time" id="saturday-leave-home" name="saturday-leave-home">
                        </div>
                        <div>
                            <label for="saturday-arrive-office">Time Arrive Office:</label>
                            <input type="time" id="saturday-arrive-office" name="saturday-arrive-office">
                        </div>
                    </div>
                    <div class="inline-fields">
                        <div>
                            <label for="saturday-leave-office">Time Leave Office:</label>
                            <input type="time" id="saturday-leave-office" name="saturday-leave-office">
                        </div>
                        <div>
                            <label for="saturday-arrive-home">Time Arrive Home:</label>
                            <input type="time" id="saturday-arrive-home" name="saturday-arrive-home">
                        </div>
                    </div>
                </div>

                <div class="day-row">
                    <input type="checkbox" id="sunday" name="days[]" value="Sunday" onchange="toggleTimeFields('sunday')">
                    <label for="sunday">Sunday</label>
                </div>
                <div id="sunday-time-fields" class="time-fields" style="display:none;">
                    <div class="inline-fields">
                        <div>
                            <label for="sunday-leave-home">Time Leave Home:</label>
                            <input type="time" id="sunday-leave-home" name="sunday-leave-home">
                        </div>
                        <div>
                            <label for="sunday-arrive-office">Time Arrive Office:</label>
                            <input type="time" id="sunday-arrive-office" name="sunday-arrive-office">
                        </div>
                    </div>
                    <div class="inline-fields">
                        <div>
                            <label for="sunday-leave-office">Time Leave Office:</label>
                            <input type="time" id="sunday-leave-office" name="sunday-leave-office">
                        </div>
                        <div>
                            <label for="sunday-arrive-home">Time Arrive Home:</label>
                            <input type="time" id="sunday-arrive-home" name="sunday-arrive-home">
                        </div>
                    </div>
                </div>

            </div>
            
            <div class="form-group">
                <label for="weekly-mileage">Percentage of weekly travel mileage due to regular commute:</label>
                <div style="display: flex; align-items: center;">
                    <input type="text" id="weekly-mileage" name="weekly-mileage" required style="width: 80px; padding-right: 30px; text-align: right;">
                    <span style="position: relative; left: -25px; color: #333;">%</span>
                </div>
            </div>
            
            <div class="form-group">
                <label for="weekly-fuel-cost">Approximate amount spent on fuel weekly:</label>
                <div style="display: flex; align-items: center;">
                    <span style="position: relative; right: -25px; color: #333;">$</span>
                    <input type="text" id="weekly-fuel-cost" name="weekly-fuel-cost" required style="width: 80px; padding-left: 30px; text-align: right;">
                </div>
            </div>
            
            <div class="form-group">
                <button type="submit">Continue to Next Step</button>
            </div>
        </form>
    </div>

    <!-- Footer Section -->
    <footer>
        <p>&copy; 2024 DRIVE2. All rights reserved.</p>
    </footer>
</body>
</html>
